var sitePeek={config:{appDomain:"http://sitepeek.tk"}};sitePeek.player=function(){var e=0,t=0,n=function(){if((event.origin||event.originalEvent.origin)===sitePeek.config.appDomain){var e=event.data||event.originalEvent.data,t=JSON.parse(e);"executeFrameAction"==t.type&&o(t.frame)}},o=function(n){$("#wrapper");if("mousemove"==n.type)0==$("#sitepeek-cursor").length&&$("body").append('<div id="sitepeek-cursor"></div>'),e=parseFloat(n.mouseX),t=parseFloat(n.mouseY),$("#sitepeek-cursor").offset({left:e,top:t});else if("click"==n.type)$('<div class="clicktrace"></div>').css({background:"cyan","border-radius":"15px",height:"30px",width:"30px",position:"absolute","z-index":"10000"}).offset({left:e-15,top:t-15}).appendTo($("body")).fadeOut(2e3,"easeOutQuint",function(){$(this).remove()}),$(n.target).trigger("click");else if("focusin"==n.type)$(n.target).trigger("focus");else if("focusout"==n.type)$(n.target).trigger("blur");else if("text"==n.type){var o=$(n.target);o.val(n.text),function(e,t){if(e.value=e.value,null!==e){if(e.createTextRange){var n=e.createTextRange();return n.move("character",t),n.select(),!0}e.selectionStart||0===e.selectionStart?(e.focus(),e.setSelectionRange(t,t)):e.focus()}}(o[0],n.caret)}else"scroll"==n.type&&$("body").scrollTop(n.scrollTop).scrollLeft(n.scrollLeft)};return{init:function(){$.extend($.easing,{easeOutQuint:function(e,t,n,o,i){return o*((t=t/i-1)*t*t*t*t+1)+n}}),$(window).on("message",n),document.write("<style type='text/css'>#sitepeek-cursor {\n    background: transparent url('img/cursor.png') no-repeat;\n    position: absolute;\n    width: 12px;\n    height: 20px;\n    z-index: 10000;\n}</style>")}}}(),sitePeek.recorder=function(){var e=!0,t=!0,n=function(){if((event.origin||event.originalEvent.origin)===sitePeek.config.appDomain){var e=event.data||event.originalEvent.data;"testspaceReady"==JSON.parse(e).type&&(o(),g(location.href))}},o=function(){var n=$("body");n.on("mousemove",function(e){s(e)}),setInterval(function(){e=!0},20),n.on("click",function(e){c(e)}),$(document).on("focusin",function(e){u(e)}),$(document).on("focusout",function(e){p(e)}),$(document).on("input propertychange",function(e){void 0==$(e.target).prop("toBeFramed")&&($(e.target).prop("toBeFramed",!0),setTimeout(function(){l(e)},1e3))}),$(window).on("scroll",function(){f($(window).scrollTop(),$(window).scrollLeft())}),setInterval(function(){t=!0},20)},i=function(){return Date.now||(Date.now=function(){return(new Date).getTime()}),Date.now()},r=function(e){for(var t=[];e.nodeType===Node.ELEMENT_NODE;){var n=e.nodeName.toLowerCase();if(e.id){n+="#"+e.id,t.unshift(n);break}for(var o=e,i=1;o=o.previousElementSibling;)o.nodeName.toLowerCase()==n&&i++;null==e.previousElementSibling&&null==e.nextElementSibling||(n+=":nth-of-type("+i+")"),t.unshift(n),e=e.parentNode}return t.join(" > ")},a=function(e){var t={type:"addFrame",frame:e};sitePeek.utils.sendMessageToOrigin(window.parent,t,sitePeek.config.appDomain)},s=function(t){e&&(a({type:"mousemove",timestamp:i(),mouseX:t.pageX,mouseY:t.pageY}),e=!1)},c=function(e){a({type:"click",timestamp:i(),mouseX:e.pageX,mouseY:e.pageY,target:r(e.target)})},u=function(e){a({type:"focusin",timestamp:i(),target:r(e.target)})},p=function(e){a({type:"focusout",timestamp:i(),target:r(e.target)})},l=function(e){a({type:"text",timestamp:i(),target:r(e.target),text:$(e.target).val(),caret:function(e){var t,n,o,i,r,a=0;try{"number"==typeof e.selectionStart&&"number"==typeof e.selectionEnd?a=e.selectionStart:(n=document.selection.createRange())&&n.parentElement()==e&&(i=e.value.length,t=e.value.replace(/\r\n/g,"\n"),(o=e.createTextRange()).moveToBookmark(n.getBookmark()),(r=e.createTextRange()).collapse(!1),o.compareEndPoints("StartToEnd",r)>-1?a=i:(a=-o.moveStart("character",-i),a+=t.slice(0,a).split("\n").length-1))}catch(e){a=0}return a}(e.target)}),$(e.target).removeProp("toBeFramed")},f=function(e,n){t&&(a({type:"scroll",timestamp:i(),scrollTop:e,scrollLeft:n}),t=!1)},g=function(e){a({type:"load",timestamp:i(),href:e})};return{init:function(){$(window).on("message",n)}}}(),sitePeek.utils={sendMessageToOrigin:function(e,t,n){var o=JSON.stringify(t);e.postMessage(o,n)}},function(){var e;(function(){try{return window.self!==window.top}catch(e){return!0}})()&&(e={type:"sitepeekLibLoaded",currentUrl:window.location.href},sitePeek.utils.sendMessageToOrigin(window.parent,e,sitePeek.config.appDomain),sitePeek.recorder.init(),sitePeek.player.init())}();